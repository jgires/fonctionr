---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# fonctionr

<!-- badges: start -->

<!-- badges: end -->

Description à venir !

# A régler (nécessités ou bugs)

## Question du filtrage

[***V C'EST FAIT***]{.underline}\
Il semble qu'il faille absolument filtrer APRES la déclaration du design. Si on le fait pas, on considère le design sur l'objet filtré (avec moins de PSU / strates qu'il y en a en réalité), ce qui sous-estime potentiellement la distribution d'échantillonnage.

Voir :

-   <https://stats.stackexchange.com/questions/411026/why-it-is-important-to-make-survey-design-object-svydesign-function-in-r-with-i>

-   <https://notstatschat.rbind.io/2021/07/22/subsets-and-subpopulations-in-survey-inference/>

De ce fait, j'ai inclu une option de filtre (`filter_exp`) dans les fonctions (qui filtre après la déclaration du design), qui évite de filtrer l'objet avant en dégradant le design.\
=\> Vérifier que c'est bien OK !

## Question de la suppression des valeurs manquantes

Dans `prop_group`, garder la possibilité de calculer une proportion sur tout le groupe (y compris les `NA`) =\> utile lorsque le `NA` a une signification (exemple : les personnes qui ne peuvent pas avoir d'arriérés sur leur loyer ou leur emprunt, car ils n'ont pas de loyer ou d'emprunt).

## En général

-   Ajouter des checks pour les inputs :

    1.  Existence des colonnes dans le dataframe =\> fait pour prop_group ;
    2.  Pas mettre les mêmes colonnes dans les différents arguments (`group`, `var_distrib`, `facet_var`, etc.) ;
    3.  Suffisamment de modalités (pas de facteur à 1 modalité, par ex.) ;
    4.  Autres ? =\> tester

-   Mettre des conditions sur les tests (n min, distribution, variances égales...)

-   Les cluster \| strates \| weights n'apparaissent pas dans le message de la console avec les replicates =\> trouver la cause ? Ou changer de méthode =\> faire un print de l'objet survey affiche les caractéristiques du design =\> bcp mieux, mais je ne saisis pas comment c'est fait.

## central_group

-   Bypasser l'erreur du test stat avec `tryCatch()` =\> déjà fait pour `crosstable()`
-   Implémenter l'export excel comme pour `prop_group` =\> pas oublier d'ajouter `broom` dans les dépendances

## prop_group

-   Bypasser l'erreur du test stat avec `tryCatch()` =\> déjà fait pour `crosstable()`
-   L'argument `expression` est sans doute mal nommé. Il vaudrait mieux le nommer `prop_expr` ?
-   Une expression qui contient `is.na(x)` ne fonctionne pas, car je supprime les `NA` sur les variables de l'expression ! =\> Exclure la possibilité d'entrer la fonction `is.na()` dans l'expression ?
-   Néanmoins (par rapport au point précédent), ajouter la possibilité de calculer une proportion avec les NA au dénominateur (avec un argument).

## crosstable

-   Implémenter un test stat lorsqu'il y a des facet =\> via modélisation loglinéaire, mais j'ai un peu de mal avec `survey` (erreurs fréquentes).

-   Implémenter l'export excel comme pour `prop_group` =\> pas oublier d'ajouter `broom` dans les dépendances

# Améliorations

## En général

-   Ajouter la possibilité de créer des replicates sur base d'un data.frame ? <!--# FR : Franchement, je ne crois pas que ce soit utile, car cela n'arrive pas si souvent et si c'est le cas, il faut bien réfléchir avant à comment créer les replicates (ex SILC) et donc je pense qu'alors c'est en amont qu'il faut créer les replicates. En plus comme créer les replicate prend du temps, c'est un beu bête de le faire à chaque fois -->

-   Créer une fonction pour transformer les données en objet srvyr (redondance entre les 3 fonctions)

## central_group

-   Pouvoir réordonner avec les facet =\> solution avec `tidytext` <https://juliasilge.com/blog/reorder-within/>

## prop_group

-   Pouvoir réordonner avec les facet =\> solution avec `tidytext` <https://juliasilge.com/blog/reorder-within/>

## crosstable

-   Ajouter un total ? Il faudrait une autre couleur, sinon pas clair =\> comment faire vu qu'il y a la palette de couleur des modalités ? <!--# FR : idée : utiliser des textures? hachures?  -->

-   Réordonner les levels sur la variable `group` ? Mais selon quelle valeur (vu qu'il y en a plusieurs) ? Celle du premier level de la variable `var_distrib` ? <!--# FR :  cela peut me sembler une bonne idée. -->

-   Ajouter les effectifs totaux par groupe ? (dans le nom du groupe ?) <!--# Cela me semble une bonne idée -->

-   possibilité d'indiquer un vecteur avec une palette de couleur pour coller avec le code couleur de notre institition

-   ajuster la légende (nombre de lignes?) pour éviter de masquer une partie de celle-ci <!--# J'ai souvent eu le cas. Même si c'est un détail, cela rend impossible l'utilisation du grpahique propre dans un rapport -->

## var_cat

-   ajouter un test

-   ajouter un filtre

    -   c'est fait, mais il faut ajouter des conditions d'arret si certain caractères ne fontionnent pas

-   quid des NA ? couleur distincte? Si oui à faire

-   quid des NA dans les facets? Les supprimer? faire une catégorie à part? Actuellement, il en fait une catégorie à part.

-   Concernant le réordonne ment des modalités, le choix a été fait de ne pas laisser la possibilité de réordonner.

-   Exporter

-   mettre les n et positionner à gauche

    -   C'est fait, mais comment représenter quand la part est trop faible. et, est-ce pertinent? Faut-il ne pas plutôt mettre la totalité du n

# Fonctions à créer

## Univarié

-   Densité pour le général (pour variable continue)

## Bivarié ou 3 variables+

-   prop/moyenne/médiane par 2 groupes

-   Distribution par groupe (profils ligne ou colonne) ([*ME RAPPELLE PLUS : C'EST QUOI ???*]{.underline})

-   Tableau croisé avec résidus ou couleur par proportion (proportions par c, l, ou total)

-   Différents indicateurs + IC par groupe ([*PAS OK AVEC PIVOT_LONG_SURVEY ?*]{.underline})

-   Densité par groupe (pour variable continue)
